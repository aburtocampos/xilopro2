@model xilopro2.Models.DashboardViewModel
@{
    ViewData["Title"] = "Inicio";
}

<link rel="stylesheet" href="./css/dashboard.css" />

<div class="container pt-2">
    <div class="row">
        <div class="text-center">
            <h1 class="display-4">Bienvenido usuario: @User.Identity.Name</h1>

        </div>
    </div>
    <section class="statscards my-4" >
        <div class="row g-3">
            <div class="col-6 col-md-6 col-lg-3">
                <div class="card border-success">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <span class="card-title m-0 fs-2 fw-bold">@Model.TotalUsers</span>
                        <i class="fa-solid fa-users fa-xl"></i>
                    </div>
                    <div class="card-footer bg-success text-bg-dark d-flex justify-content-between align-items-center">
                        <span class="m-0 fs-4">Usuarios</span>
                        @if(User.IsInRole("Editor")){
                            <a asp-action="Index" asp-controller="Users" class="btn btn-outline-light">Ir a Usuarios</a>
                        }
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-6 col-lg-3">
                <div class="card border-primary">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <span class="card-title m-0 fs-2 fw-bold">@Model.TotalPlayers</span>
                        <i class="fa-solid fa-person-running fa-xl"></i>
                    </div>
                    <div class="card-footer bg-primary text-bg-dark d-flex justify-content-between align-items-center">
                        <span class=" m-0 fs-4">Jugadores</span>
                        <a asp-action="Index" asp-controller="Players" class="btn btn-outline-light">Ir a Jugadores</a>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-6 col-lg-3">
                <div class="card border-dark">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <span class="card-title m-0 fs-2 fw-bold">@Model.TotalParents</span>
                        <i class="fa-solid fa-restroom fa-xl"></i>
                    </div>
                    <div class="card-footer bg-dark text-bg-dark d-flex justify-content-between align-items-center">
                        <span class=" m-0 fs-4">Tutores</span>
                        <a asp-action="IndexParents" asp-controller="Players" class="btn btn-outline-light">Ir a Tutores</a>
                    </div>
                </div>
            </div>
            <div class="col-6 col-md-6 col-lg-3">
                <div class="card border-purple">
                    <div class="card-body d-flex justify-content-between align-items-center">
                        <span class="card-title m-0 fs-2 fw-bold">@Model.TotalTorneos</span>
                        <i class="fa-solid fa-restroom fa-xl"></i>
                    </div>
                    <div class="card-footer bg-purple text-bg-dark d-flex justify-content-between align-items-center">
                        <span class=" m-0 fs-4">Torneos</span>
                        <a asp-action="Index" asp-controller="Torneos" class="btn btn-outline-light">Ir a Torneos</a>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="container pt-2">
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body row">
                        <div class="col-md-8">
                            <canvas id="chartGoles" style="min-height:190px;max-height:190px;height:100%!important;"></canvas>
                        </div>
                        <div class="col-md-4">
                            <ul class="list-group">
                                <li class="list-group-item active" aria-current="true">An active item</li>
                                <li class="list-group-item">A second item</li>
                                <li class="list-group-item">A third item</li>
                                <li class="list-group-item">A fourth item</li>
                                <li class="list-group-item">And a fifth one</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="card" style="margin-top: 0.75rem !important;">
                    <div class="card-body row">
                        <div class="col-md-6">
                            
                        </div>
                        <div class="col-md-6">
                            
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-md-6">
                <div class="card">
                    <div class="card-body">
                        <canvas id="chartJugadores" style="max-height:350px;"></canvas>
                    </div>
                </div>
            </div>
        </div>  
    </section>

</div>

@section Scripts{

<script>

        $(document).ready(() => {

            goles();
            jugadores();
        })


    function goles() {
        fetch("Home/golesxTorneo")
            .then((response) => { 
                return response.ok ? response.json() : Promise.reject(response);
            })
            .then((dataJson) => { 

                const labels = dataJson.map((item) => { return item.nombreTorneo })
                const values = dataJson.map((item) => { return item.cantidadGoles })
                const values2 = dataJson.map((item) => { return item.temporada })

                //    console.log('dataJson', dataJson);
                //    console.log('values', values);
                 //   console.log(typeof values);

                const data = {
                        labels: labels,
                    datasets: [{
                        label: 'Goles 2024',
                        data: values,//[65, 59, 80, 81, 56, 55, 40],
                        backgroundColor: [
                                'rgba(255, 99, 132, 0.2)',
                                'rgba(255, 159, 64, 0.2)',
                        ],
                            borderColor: [
                                'rgb(255, 99, 132)',
                                'rgb(255, 159, 64)',
                            ],
                            borderWidth: 1
                    }]
                };

               
                const config = {
                    type: 'bar',
                    data: data,
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    },
                };


                const canvasBarras = document.getElementById("chartGoles");
                const graficoBarras = new Chart(canvasBarras, config);

            }).catch((error) => {
                    console.log("error", error)

            })
    }


        function jugadores() {

            fetch("Home/jugadoresxCat")
                .then((response) => {
                    return response.ok ? response.json() : Promise.reject(response);
                })
                .then((dataJson) => {

                    const labels = dataJson.map((item) => { return item.categorias })
                    const values = dataJson.map((item) => { return item.cantidadJugadores })


                    console.log('dataJson', dataJson);
                       console.log('values', values);
                       console.log(typeof values);

                    const data = {
                        labels: labels,
                        datasets: [{
                            label: 'Jugadores por Categorias',
                            data: values,
                            backgroundColor: [
                                'rgb(255, 99, 132)',
                                'rgb(54, 162, 235)',
                                'rgb(255, 205, 86)',
                                "#01AF40"
                            ],
                            hoverOffset: 4
                        }]
                    };


                    const config = {
                        type: 'doughnut',
                        data: data,
                    };


                    const canvasDona = document.getElementById("chartJugadores");

                    const graficoDona = new Chart(canvasDona, config)

                }).catch((error) => {
                    console.log("error")

                })


        }


</script>
}